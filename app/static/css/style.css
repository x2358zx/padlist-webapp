\
* { box-sizing: border-box; }
html, body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", Arial, sans-serif; }
.container { max-width: 1300px; margin: 0 auto; padding: 16px; }
header { display:flex; align-items:center; gap:16px; margin-bottom: 12px; }
.title { font-weight: 700; font-size: 18px; }
.version-badge .icon { font-size:12px; }
.version-badge {
  display: inline-flex;           /* 讓文字和小圖示更居中 */
  align-items: center;
  gap: 4px;                       /* 圖示和文字之間的間距 */
  font-size: 13px;
  font-weight: 500;               /* 字稍微加粗，看起來更清晰 */
  color: #fff;                    /* 白字 */
  background: linear-gradient(135deg, #4CAF50, #2E7D32); /* 綠色漸層 */
  padding: 4px 10px;              /* 上下 4px、左右 10px，讓 badge 比較圓潤 */
  border-radius: 999px;           /* 超圓角，做成膠囊狀 */
  box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* 輕微陰影 */
  transition: background 0.3s ease;
}

.version-badge:hover {
  background: linear-gradient(135deg, #66BB6A, #388E3C); /* hover 更亮一點 */
}
.nowtime { margin-left:auto; color:#777; font-size:12px; }

main { display:grid; grid-template-columns: 420px 1fr; gap: 16px; }
.left-pane .controls, .coord-controls, .section, .notice { background:#fff; border:1px solid #e5e5e5; padding:10px 12px; border-radius:10px; margin-bottom:12px; }
.status { margin-bottom:6px; font-weight:600; }
.status.normal { color:#1b66d1; }
.status.error { color:#d11b1b; white-space: pre-wrap; }

.left-pane .row { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
.left-pane .row.group { flex-direction:column; align-items:flex-start; gap:4px; }
.left-pane input[type="text"], .left-pane input[type="number"], select { border:1px solid #ccc; border-radius:8px; padding:6px 8px; width: 80px; }
.left-pane select { border:1px solid #ccc; border-radius:8px; padding:6px 8px; width: 250px; }
.left-pane .btn { display:inline-flex; align-items:center; gap:8px; }
.left-pane .file-btn { background:#222; color:white; border-radius:8px; padding:8px 12px; cursor:pointer; }
.left-pane button { background:#0d6efd; color:white; border:none; padding:8px 10px; border-radius:8px; cursor:pointer; }
.left-pane button:hover { opacity:0.9; }
.zoom-row input[type="range"] { width: 200px; }

.section-title { font-weight:700; margin-bottom:8px; }
.grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap:6px 10px; }

.notice ul { margin:0; padding-left:20px; }

.right-pane .project-code { margin-bottom: 8px; }
#stageWrapper { border:1px solid #e1e1e1; border-radius:12px; padding:8px; background:#fafafa; width: fit-content; }
.stage { position: relative; background:white; overflow:hidden; transform-origin: 0 0; }

.overlay { 
  position:absolute; 
  left:0; 
  top:0; 
  pointer-events:none; 
  z-index: 15; /* ★ 新增，確保圖層在文字框(z-index:10)之上 */
}


/* 顏色 */
.bg-blue { background:#add8e6; }  /* 淺藍 */
.bg-gray { background:#dcdcdc; }  /* 灰 */
.bg-green { background:#90ee90; } /* 淺綠 */
.bg-pink { background:#ffc0cb; }  /* 粉紅 */

.actions { margin-top: 10px; }
.invalid-list pre { min-height: 80px; max-height: 200px; overflow:auto; background:#fff7f7; padding:8px; border:1px solid #ffd6d6; border-radius:8px; }

/* 旋轉的上/下邊欄位 */
.rotate90 { transform: rotate(90deg); transform-origin:left top; }

.pin-label { 
position:absolute;
font-size:12px; 
width:25px;
height:25px;
display:flex;
align-items:center;
justify-content:center;
border-radius:4px;
}

/* 用於截圖的替身盒子（只在複製/下載時使用） */
/* 取代原本的 .pin-input：不可編輯的方塊 */
.pin-box{
  position: absolute;
  width: 80px;
  height: 25px;
  border: 1px solid #ccc;
  border-radius: 4px;
  background: #fff;
  font-size: 12px;
  display: flex;                /* ← 讓內容水平/垂直置中 */
  align-items: center;          /* 垂直置中 */
  justify-content: center;      /* 水平置中 */
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  z-index: 10;
}

/* 旋轉（頂/底那排用） */
.pin-box.rotate90{
  transform: rotate(90deg);
  transform-origin: left top;
}

/* 顏色規則（沿用你原本的判斷） */
.pin-box.bg-gray { background: #dcdcdc; }
.pin-box.bg-green{ background: #90ee90; }
.pin-box.bg-pink { background: #ffc0cb; }
.pin-box.bg-blue { background: #add8e6; }

/* 若你有分邊位移（只影響畫面，不影響截圖），保留原本的 side-* 規則即可 */

/* 先隱藏圖片，等成功載入再顯示 */
.chip-image {
	display: none;
	position: absolute;
	z-index: 2;/* 讓圖片的 z-index 比背景高，確保能蓋住 */
	}
.chip-image.loaded { display: block; }



/* 讓 stage 成為定位容器 */
#stage { position: relative; }

/* === 底部 HUD：統一高度、完美對齊 === */
.stage-hud{
  /* 已在底部：left/right/bottom 請保留你的設定 */
  position: absolute;
  left: 8px; right: 8px; bottom: 8px;

  display: flex;
  align-items: stretch;      /* 讓每個 item 拉到同高 */
  justify-content: space-between;
  gap: 8px;
  z-index: 20;
  pointer-events: none;
}

/* ★ 新增：PadWindow/CUP 膠囊排（放在 Project Code 上方） */
.stage-hud.meta-hud{
  bottom: 50px;                 /* 比下方那排（bottom:8px）再上移 ~42px */
  justify-content: flex-start;  /* 貼左 */
  gap: 8px;
}

/* 膠囊本體：固定高度，文字垂直置中 */
.stage-hud .hud-item{
  display: flex;
  align-items: center;
  height: 34px;              /* ← 統一高度（想更厚可調 36/38） */
  box-sizing: border-box;
  padding: 0 12px;           /* 垂直用 0，文字自然置中 */
  line-height: 1;            /* 避免行高影響觀感 */
  font-size: 12px;           /* 兩邊字體一致 */
  background: rgba(255,255,255,0.92);
  border: 1px solid #ddd;
  border-radius: 999px;      /* 更圓潤的膠囊 */
  color: #333;
  box-shadow: 0 1px 2px rgba(0,0,0,0.06);
  pointer-events: auto;
}

/* Project Code 區可伸縮，長字用省略號 */
.stage-hud .project-code{
  flex: 1;
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.stage-hud .project-code span{ margin-right: 6px; opacity: .7; }

/* 時間固定寬度、不被擠壓 */
.stage-hud .nowtime{ flex: 0 0 auto; }

.stage-hud.meta-hud .hud-item{
  min-width: 140px;             /* 視覺穩定（可依實際文字長度微調） */
}


/* 避免繼承到 header 的 margin 規則 */
.stage .nowtime, .stage .project-code { margin: 0; }

/* （可選）在畫布內預留空間，避免視覺壓住底部內容 */
.stage { padding-bottom: 44px; }

/* ===== 頁面狀態列（header 下方，非截圖區） ===== */
.status-bar{
  display: flex;
  justify-content: center;   /* 整排置中 */
  align-items: stretch;
  gap: 10px;
  padding: 8px 12px;         /* 與 header 保持距離 */
  /* 想讓它一直貼在頂部可改成 sticky：*/
  position: sticky; top: 0; z-index: 50; background: #fff;
}

.status-bar .status{
  display: flex;
  align-items: center;       /* 垂直置中 */
  justify-content: center;   /* 文字水平置中 */
  height: 34px;              /* 統一高度 */
  padding: 0 14px;
  border-radius: 999px;      /* 膠囊外觀 */
  border: 2px solid #ddd;
  background: rgba(255,255,255,.96);
  line-height: 1;
  font-size: 12px;
  white-space: nowrap;
  max-width: 60vw;           /* 避免太長撐滿 */
  overflow: hidden;
  text-overflow: ellipsis;
  box-shadow: 0 1px 2px rgba(0,0,0,.06);
}

/* 狀態配色（新增 warn，用於無法連線 PIN 提示） */
.status-bar .status.warn{
  border-color: #ffdf91;
  background: rgba(255,249,230,.96);
  color: #7a4d00;
}



/* 無法連線 PIN 膠囊：預設展開，可收合 */
.invalid-capsule{
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 6px;
  max-width: 60vw;
}
.invalid-capsule .capsule-row{
  display: flex;
  align-items: center;
  gap: 8px;
}
.invalid-capsule .toggle{
  margin-left: auto;          /* 貼齊最右邊 */
  background: transparent;
  border: none;
  color: inherit;
  font-weight: 800;
  cursor: pointer;
  padding: 0 4px;
  line-height: 1;
}
.invalid-capsule .details{
  white-space: pre-wrap;
  max-height: 160px;
  overflow: auto;
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.35);
  border-radius: 8px;
  padding: 6px 8px;
  color: #fff;
}
.invalid-capsule.collapsed .details{ display: none; }

.invalid-list pre{
  background:#ffecec;
  border-color:#ff8a80;
}

/* === 新紅色樣式（柔和但醒目） === */
.status-bar .status.danger{
  /* 取代原本的實心大紅底 */
  border-color: #ff8a80;
  border: 2px solid #ff9aa7;
  background: linear-gradient(180deg, #fff1f3 0%, #ffe4e7 100%);
  color: #7b1620;
  box-shadow: 0 2px 6px rgba(255,0,48,.15);
}

/* ▲ 展開時：膠囊浮在畫面頂部，可超出原本狀態列高度 */
#invalidCapsule[aria-expanded="true"]{
  position: fixed;             /* 直接貼在視窗頂端 */
  padding-top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 2000;               /* 蓋在頁面上方 */
  width: clamp(320px, 60vw, 900px);

  /* 打破「一行膠囊」的限制 */
  height: auto;
  white-space: normal;
  overflow: visible;
  text-overflow: clip;

  /* 舒服一點的卡片效果 */
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,.12);
}

/* 展開時的內容區：給比較大的可視高度、可捲動 */
#invalidCapsule[aria-expanded="true"] .details{
  max-height: 60vh;            /* 依視窗高度自適應 */
  overflow: auto;
  background: #fff;            /* 內容改白底 */
  border: 2px dashed #ff9aa7;  /* 與外框同色的虛線 */
  color: #7b1620;
}

/* 收合狀態維持單列高度不變（使用原本 .status 的 34px 規格） */
.invalid-capsule.collapsed .details{ display:none; }

/* 細節：標題列左側做個小紅色指示條，辨識更清楚（可移除） */
.invalid-capsule .capsule-row{
  position: relative;
  padding-left: 8px;
}
.invalid-capsule .capsule-row::before{
  content:"";
  position:absolute;
  left:0; top:50%; transform:translateY(-50%);
  width:4px; height:18px;
  border-radius: 2px;
  background: linear-gradient(180deg,#ff5a6a,#ff3d57);
}


/* 狀態配色（可自行調整） */
.status-bar .status.normal{
  border-color: #cfe0ff;
  background: rgba(240,248,255,.96);
  color: #1d3a6a;
}
.status-bar .status.error{
  border-color: #f2b5b5;
  background: rgba(255,235,235,.96);
  color: #b00020;
}

/* 沒內容就自動隱藏第二顆 */
.status-bar .status:empty{ display: none; }


/* style.css */
.left-pane input[readonly]{
  background:#f7f7f7;
  cursor:not-allowed;
}

/* === MIN/MAX OFFSET 膠囊卡片 === */
.capsule-block{
  background:#fff;
  border:1px solid #e5e5e5;
  border-radius:12px;
  padding:10px 12px;
  margin-bottom:15px;              /* 下推開 15px */
}

/* legend 做成小膠囊標籤（和狀態列膠囊一致風格） */
.capsule-legend{
  display:inline-flex;
  align-items:center;
  height:28px;
  padding:0 12px;
  border-radius:999px;
  border:1px solid #cfe0ff;
  background:rgba(240,248,255,.96);
  line-height:1;
  font-weight:700;
  font-size:12px;
}

/* 行內排版：左標題 + 右控制 */
.group .row{
  display:flex;
  align-items:center;
  gap:.5rem;
  justify-content:space-between;
}

/* 拉桿佔滿可用寬度；使用環境主色做重點 */
.group .row .range,
.offset-grid .range{
  flex:1 1 auto;
  accent-color:#0d6efd;
  min-width:160px;
}

/* 數值顯示：小膠囊 */
.value-badge{
  display:inline-flex;
  align-items:center;
  height:26px;
  padding:0 10px;
  border-radius:999px;
  border:1px solid #ddd;
  background:rgba(255,255,255,.96);
  line-height:1;
  font-size:12px;
  color:#333;
  box-shadow:0 1px 2px rgba(0,0,0,.06);
}

/* 多列控制（上右下左）維持一欄、每列左右對齊 */
.offset-grid{
  display:grid;
  grid-template-columns:1fr;
  gap:.35rem;
  margin-top:.25rem;
}
.offset-grid label{
  display:flex;
  align-items:center;
  gap:.5rem;
  justify-content:space-between;
}

/* 右下角按鈕靠右 */
.group .row.end{
  justify-content:flex-end;
  margin-top:.25rem;
}

/* 確保 hidden 真的隱藏 */
[hidden] { display: none !important; }

.is-invalid{
  outline: 2px solid #dc3545;
  background: #fff5f5;
}

/* --- 底部的 EPAD 背景裝飾 --- */
#epadBackground {
  position: absolute;
  /* 透過 left: 50% 和 transform 來達成水平置中 */
  left: 50%;
  top: 47%;                     /* ★ 修改：從 top 往下 50% */
  transform: translate(-50%, -50%); /* ★ 修改：水平和垂直都回移 50% */
  
  width: 400px;
  height: 560px;
  
  background: #ffffe0; /* 淺黃色背景 */
  border: 2px dashed #f0e68c; /* 黃色虛線 */
  border-radius: 12px;
  
  /* --- EPAD 文字的樣式 --- */
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 80px; /* 加大字體 */
  font-weight: bold; /* 粗體 */
  color: rgba(211, 211, 211, 0.7); /* 淡灰色半透明 */
  
  /* 確保它在最底層，圖片會蓋在它上面 */
  z-index: 1;
}

/* === 空白鍵拖曳平移的游標與選字控制 === */
#stageWrapper.space-pan-ready { cursor: grab; }
#stageWrapper.space-pan-active { cursor: grabbing; }
#stageWrapper.space-pan-active, 
#stage.space-pan-active {
  user-select: none;
}

/* === Corner-conflict line highlight === */
.overlay line.conflict {
  stroke: #ff3b30;      /* 醒目紅 */
  stroke-width: 3;      /* 比一般線更粗 */
  animation: cornerPulse 0.9s ease-in-out infinite alternate;
  filter: drop-shadow(0 0 2px rgba(255,59,48,0.6));
}
@keyframes cornerPulse {
  from { opacity: 1; }
  to   { opacity: 0.45; }
}
