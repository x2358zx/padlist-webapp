<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PAD List Web</title>
  <link rel="icon" href="/static/app.ico"/>
  <link rel="stylesheet" href="/static/css/style.css"/>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">PAD List</div>
	  <div class="version-badge" title="PAD List WEB v1.2.0: 2025/09/01">
        <span class="icon">⚙</span>
        <span>Version 1.1.0</span>
      </div>
    </header>
	
	<!-- 頁面狀態列（不在截圖區） -->
	<div id="pageStatusBar" class="status-bar" data-html2canvas-ignore="true">
	  <div id="status" class="status normal" role="status" aria-live="polite">
		等待選擇檔案...
	  </div>
	  <div id="error" class="status error" role="alert" aria-live="assertive"></div>
	  <!-- 無法連線 PIN 的頂部紅色膠囊（預設隱藏；有資料才顯示） -->
	  <div id="invalidCapsule"
	  	   class="status danger invalid-capsule"
	  	   role="region"
	  	   aria-live="polite"
	  	   aria-expanded="true"
	  	   hidden>
	      <div class="capsule-row">
	  	  <span id="invalidTop" class="title">無法連線 PIN：<b id="invalidCount">0</b> 筆</span>
	  	  <button id="invalidToggle" class="toggle" type="button" aria-label="收合">▲</button>
	      </div>
	      <pre id="invalidPinsTop" class="details"></pre>
	  </div>

	</div>
	
    <main>
      <section class="left-pane">

        <div class="controls">
          <div class="row">
            <label class="btn file-btn">
              1. 選擇Excel檔案
              <input id="excelFile" type="file" accept=".xlsx" hidden />
            </label>
          </div>

          <div class="row">
            <label>選擇工作表：</label>
            <select id="sheetSelector"></select>
          </div>

          <div class="row group">
            <div class="row">
              <label>chip size 寬度：</label>
              <input id="chipWidth" type="text" readonly />
            </div>
            <div class="row">
              <label>chip size 高度：</label>
              <input id="chipHeight" type="text" readonly />
            </div>
          </div>
		  
          <div class="row">
            <button id="loadDataBtn">2. 載入資料</button>
          </div>
        </div>

        <!-- ★ 改成自動偵測：這段預設隱藏，如需除錯再拿掉 hidden -->
        <div class="section" hidden>
          <div class="section-title">欄位設定（已改為自動偵測）</div>
          <div class="grid-2">
            <label>Chip Size 儲存格：</label><input id="chipCell" type="text" value="C3"/>
            <label>Project Code 儲存格：</label><input id="projectCell" type="text" value="C2"/>
            <label>Pin編號欄位：</label><input id="pinNoCol" type="text" value="B"/>
            <label>Pin名稱欄位：</label><input id="pinNameCol" type="text" value="C"/>
            <label>X座標欄位：</label><input id="xCol" type="text" value="D"/>
            <label>Y座標欄位：</label><input id="yCol" type="text" value="E"/>
            <label>資料起始行：</label><input id="startRow" type="number" value="8"/>
          </div>
        </div>

<div id="dataControls" hidden>
        <div class="coord-controls">
		<!--
          <button id="btnMin">3. 選擇MIN點(左下)</button>
          <button id="btnMax">4. 選擇MAX點(右上)</button>
          <button id="btnReset">重置座標</button>
		  -->

          <div class="row zoom-row">
		    <ul>
              <li>縮放(ctrl+滾輪)：<span id="zoomVal">100%</span></li>
			  <li>滾輪中鍵按著可以抓住並且移動</li>
			</ul>
          </div>
        </div>
		
		<fieldset class="group capsule-block">
          <legend class="capsule-legend">點線樣式（Pins）</legend>
        
          <!-- 點線大小倍率 -->
          <label class="row">
            <span>點線大小</span>
            <select id="pinStyleScale">
              <option value="1.5" selected>1.5×（預設）</option>
              <option value="2.5">2.5×</option>
              <option value="4">4×</option>
            </select>
          </label>
        
          <!-- 點線顏色（三選一） -->
          <div class="row">
            <span>顏色</span>
            <div class="radio-chip-palette" id="pinStyleColorGroup">
              <label class="radio-chip">
                <input type="radio" name="pinStyleColor" value="#BEBEBE" checked>
                <span class="swatch" style="--c:#BEBEBE"></span>灰（預設）
              </label>
              <label class="radio-chip">
                <input type="radio" name="pinStyleColor" value="#00EC00">
                <span class="swatch" style="--c:#00EC00"></span>綠
              </label>
              <label class="radio-chip">
                <input type="radio" name="pinStyleColor" value="#00CACA">
                <span class="swatch" style="--c:#00CACA"></span>藍綠
              </label>
            </div>
          </div>
        </fieldset>

		
	    <fieldset class="group capsule-block">
          <legend class="capsule-legend">邊界內縮（MIN/MAX OFFSET）</legend>
        
          <label class="row">
            <span>四邊連動 (shift+滾輪可以控制)</span>
            <input id="offsetLink" type="checkbox" checked>
          </label>
        
          <label class="row">
            <span>內縮(px)</span>
            <input id="offsetAll" type="range" min="0" max="30" step="1" value="0" class="range">
            <span id="offsetAllValue" class="value-badge">0</span>
          </label>
        
          <div id="offsetGrid" class="offset-grid" style="display:none">
            <label>
              <span>上</span>
              <input id="offsetTop" type="range" min="0" max="30" step="1" value="0" class="range">
              <span id="offsetTopValue" class="value-badge">0</span>
            </label>
            <label>
              <span>右</span>
              <input id="offsetRight" type="range" min="0" max="30" step="1" value="0" class="range">
              <span id="offsetRightValue" class="value-badge">0</span>
            </label>
            <label>
              <span>下</span>
              <input id="offsetBottom" type="range" min="0" max="30" step="1" value="0" class="range">
              <span id="offsetBottomValue" class="value-badge">0</span>
            </label>
            <label>
              <span>左</span>
              <input id="offsetLeft" type="range" min="0" max="30" step="1" value="0" class="range">
              <span id="offsetLeftValue" class="value-badge">0</span>
            </label>
          </div>
        
          <div class="row end">
            <button id="offsetReset" type="button">重設</button>
          </div>
        </fieldset>
</div>

        <!-- 取代原本的 notice UL：手風琴（可同時全關，但不可同時全開） -->
<div class="notice">
  <div class="section-title">注意事項</div>

  <div class="accordion" id="noticesAcc" role="tablist" aria-multiselectable="false">
    <!-- 操作注意 -->
    <div class="acc-item">
      <button class="acc-header" data-key="operation" aria-expanded="false" type="button">
        操作注意
      </button>
      <div class="acc-panel" hidden>
        <!-- 用 <pre> 保留換行、避免 contenteditable 產生雜 tag -->
        <pre id="notice-op" class="acc-content" data-key="operation"></pre>

        <!-- 僅主管可見 -->
        <div class="acc-actions" hidden data-key="operation">
          <button class="acc-edit"   type="button">編輯</button>
          <button class="acc-save"   type="button" hidden>儲存</button>
          <button class="acc-cancel" type="button" hidden>取消</button>
        </div>
        <textarea class="acc-editor" hidden></textarea>
      </div>
    </div>

    <!-- bonding 注意 -->
    <div class="acc-item">
      <button class="acc-header" data-key="bonding" aria-expanded="false" type="button">
        bonding 注意
      </button>
      <div class="acc-panel" hidden>
        <pre id="notice-bond" class="acc-content" data-key="bonding"></pre>

        <div class="acc-actions" hidden data-key="bonding">
          <button class="acc-edit"   type="button">編輯</button>
          <button class="acc-save"   type="button" hidden>儲存</button>
          <button class="acc-cancel" type="button" hidden>取消</button>
        </div>
        <textarea class="acc-editor" hidden></textarea>
      </div>
    </div>
  </div>
</div>


      </section>

      <section class="right-pane">
        <!-- 主畫布容器（含標籤、文字框、圖片、疊加SVG） -->
        <div id="stageWrapper">
          <div id="stage" class="stage" style="width:780px;height:1000px;">
            <img id="chipImage" class="chip-image" alt="chip" />
            <svg id="overlay" class="overlay" width="780" height="1000"></svg>
			
			<!-- ★ 新增：PadWindow / CUP 膠囊（與 Project Code 膠囊同樣風格） -->
			<div class="stage-hud meta-hud">
			  <div class="hud-item"><span>PadWindow：</span><b id="padwindow"></b></div>
			  <div class="hud-item"><span>CUP：</span><b id="cup"></b></div>
			</div>

			<!-- 新增：畫布 HUD（左：Project Code；右：時間） -->
			<div class="stage-hud">
			  <div class="hud-item project-code"><span>Project Code：</span><b id="projectCode"></b></div>
			  <div class="hud-item nowtime" id="nowtime"></div>
			</div>
			<div id="epadBackground">EPAD</div>
            <!-- 文字框與標籤會動態插入 -->
          </div>
        </div>

        <div class="actions">
          <button id="btnDownload">下載 PNG 截圖</button>
		  <button id="btnCopy">📋 複製截圖</button>
		  <button id="btnViewToggle" title="切換放大/1:1 視圖">放大視圖</button>
        </div>

        <div class="invalid-list" hidden>
          <div class="section-title">無法連線的 PIN</div>
          <pre id="invalidPins"></pre>
        </div>
      </section>
    </main>
  </div>

  <script src="/static/js/html2canvas.min.js"></script> <!--先載入依賴檔-->
  <script src="/static/js/app.js"></script>
  
</body>
</html>
